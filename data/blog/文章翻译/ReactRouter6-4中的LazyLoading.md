---
title: ReactRouter6-4ä¸­çš„LazyLoading
date: '2023-03-26'
tags: ['react', 'åšæ–‡ç¿»è¯‘']
draft: false
summary: ''
---

åŸæ–‡åœ°å€ï¼š[Lazy Loading Routes in React Router 6.4+](https://remix.run/blog/lazy-loading-routes)

# React Router 6.4+ä¸­çš„æ‡’åŠ è½½è·¯ç”±

[React Router 6.4](https://remix.run/blog/react-router-v6.4) å¼•å…¥äº†[â€œæ•°æ®è·¯ç”±å™¨â€](https://reactrouter.com/en/main/routers/picking-a-router)çš„æ¦‚å¿µï¼Œä¸»è¦å…³æ³¨ç‚¹æ˜¯å°†æ•°æ®è·å–ä¸æ¸²æŸ“åˆ†ç¦»ï¼Œä»¥æ¶ˆé™¤æ¸²æŸ“ + è·å–é“¾å’Œéšä¹‹è€Œæ¥çš„æ—‹è½¬åŠ è½½å›¾æ ‡ã€‚

è¿™äº›é“¾æ¡é€šå¸¸è¢«ç§°ä¸ºâ€œç€‘å¸ƒâ€ï¼Œä½†æˆ‘ä»¬æ­£åœ¨é‡æ–°æ€è€ƒè¿™ä¸ªæœ¯è¯­ï¼Œå› ä¸ºå¤§å¤šæ•°äººå¬åˆ°â€œç€‘å¸ƒâ€å°±ä¼šæƒ³è±¡å°¼äºšåŠ æ‹‰å¤§ç€‘å¸ƒï¼Œæ‰€æœ‰çš„æ°´éƒ½ä¼šè½åœ¨ä¸€ä¸ªæ¼‚äº®çš„å¤§ç€‘å¸ƒä¸­ã€‚ä½†æ˜¯ï¼Œâ€œä¸€æ¬¡æ€§â€ä¼¼ä¹æ˜¯åŠ è½½æ•°æ®çš„å¥½æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¨åŒç€‘å¸ƒå‘¢ï¼Ÿä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥è¿½æ±‚å®ƒä»¬ï¼Ÿ

å®é™…ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦é¿å…çš„â€œç€‘å¸ƒâ€çœ‹èµ·æ¥æ›´åƒä¸Šé¢çš„æ ‡é¢˜å›¾ç‰‡ï¼Œå¹¶ä¸”ç±»ä¼¼äºæ¥¼æ¢¯ã€‚æ°´æµä¸‹æ¥ä¸€ç‚¹ï¼Œç„¶ååœæ­¢ï¼Œå†ä¸‹æ¥ä¸€ç‚¹ï¼Œç„¶ååœæ­¢ï¼Œä¾æ­¤ç±»æ¨ã€‚ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨é‚£ä¸ªæ¥¼æ¢¯ä¸­æ¯ä¸€ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªåŠ è½½æ—‹è½¬å™¨ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³ç»™ç”¨æˆ·çš„ UI ç±»å‹ï¼å› æ­¤ï¼Œåœ¨æœ¬æ–‡ï¼ˆä»¥åŠå¸Œæœ›ä¹‹å¤–ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œé“¾â€è¿™ä¸ªæœ¯è¯­æ¥è¡¨ç¤ºå›ºæœ‰é¡ºåºçš„è·å–ï¼Œå¹¶ä¸”æ¯ä¸ªè·å–éƒ½è¢«å‰é¢çš„è·å–æ‰€é˜»å¡ã€‚

## Render + Fetch Chains

å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»è¿‡[â€œRemixing React Routerâ€](https://remix.run/blog/remixing-react-router)ä¸€æ–‡æˆ–è€…å»å¹´ Reactathon ä¸Š Ryan çš„[â€œWhen to Fetchâ€](https://www.youtube.com/watch?v=95B8mnhzoCM)æ¼”è®²ï¼Œé‚£ä¹ˆåœ¨æ·±å…¥é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå»ºè®®å…ˆæŸ¥çœ‹è¿™äº›å†…å®¹ã€‚å®ƒä»¬æ¶µç›–äº†æˆ‘ä»¬å¼•å…¥æ•°æ®è·¯ç”±æ¦‚å¿µèƒŒåçš„å¾ˆå¤šèƒŒæ™¯çŸ¥è¯†ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ çš„è·¯ç”±å™¨ä¸çŸ¥é“ä½ çš„æ•°æ®éœ€æ±‚æ—¶ï¼Œä½ æœ€ç»ˆä¼šå¾—åˆ°é“¾æ¥è¯·æ±‚ï¼Œå¹¶ä¸”éšç€æ¸²æŸ“å­ç»„ä»¶ï¼Œâ€œå‘ç°â€äº†åç»­æ•°æ®éœ€æ±‚ã€‚

![å°†æ•°æ®è·å–ä¸ç»„ä»¶è€¦åˆä¼šå¯¼è‡´æ¸²æŸ“ + è·å–é“¾](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/MMGWa8.jpg)

ä½†æ˜¯å¼•å…¥æ•°æ®è·¯ç”±å™¨å¯ä»¥è®©æ‚¨å¹¶è¡Œè·å–æ•°æ®å¹¶ä¸€æ¬¡æ€§æ¸²æŸ“æ‰€æœ‰å†…å®¹ï¼š

![è·¯ç”±è·å–å¹¶è¡ŒåŒ–è¯·æ±‚ï¼Œæ¶ˆé™¤äº†ç¼“æ…¢çš„æ¸²æŸ“ + è·å–é“¾](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/OYqYzx.jpg)

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæ•°æ®è·¯ç”±å™¨å°†æ‚¨çš„è·¯ç”±å®šä¹‰ä»æ¸²æŸ“å‘¨æœŸä¸­æå–å‡ºæ¥ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„è·¯ç”±å™¨å¯ä»¥æå‰è¯†åˆ«åµŒå¥—æ•°æ®éœ€æ±‚ã€‚

```tsx
// app.jsx
import Layout, { getUser } from `./layout`
import Home from `./home`
import Projects, { getProjects } from `./projects`
import Project, { getProject } from `./project`

const routes = [
  {
    path: '/',
    loader: () => getUser(),
    element: <Layout />,
    children: [
      {
        index: true,
        element: <Home />,
      },
      {
        path: 'projects',
        loader: () => getProjects(),
        element: <Projects />,
        children: [
          {
            path: ':projectId',
            loader: ({ params }) => getProject(params.projectId),
            element: <Project />,
          },
        ],
      },
    ],
  },
]
```

ä½†è¿™ä¹Ÿæœ‰ä¸€ä¸ªç¼ºç‚¹ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†å¦‚ä½•ä¼˜åŒ–æ•°æ®è·å–ï¼Œä½†æˆ‘ä»¬è¿˜å¿…é¡»è€ƒè™‘å¦‚ä½•ä¼˜åŒ– JS æ†ç»‘åŒ…çš„è·å–ï¼é€šè¿‡ä¸Šé¢çš„è·¯ç”±å®šä¹‰ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥å¹¶è¡Œåœ°è·å–æ‰€æœ‰æ•°æ®ï¼Œä½†æˆ‘ä»¬é˜»å¡äº†æ•°æ®è·å–çš„å¼€å§‹ï¼Œå› ä¸ºè¦ä¸‹è½½åŒ…å«æ‰€æœ‰åŠ è½½å™¨å’Œç»„ä»¶çš„ Javascript æ†ç»‘åŒ…ã€‚

è€ƒè™‘ä¸€ä¸ªç”¨æˆ·åœ¨ / è·¯ç”±ä¸Šè¿›å…¥æ‚¨çš„ç½‘ç«™ï¼š

![å•ä¸ª JS æ†ç»‘åŒ…é˜»æ­¢äº†æ•°æ®è·å–](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/cJ4SjZ.jpg)

## React.lazy èƒ½æ‹¯æ•‘æˆ‘ä»¬å—ï¼Ÿ

[React.lazy ](https://beta.reactjs.org/reference/react/lazy)æä¾›äº†ä¸€ç§ä¼˜ç§€çš„åŸè¯­æ¥åˆ†å—ç»„ä»¶æ ‘ï¼Œä½†å®ƒé­å—ç€ä¸æ•°æ®è·¯ç”±å™¨è¯•å›¾æ¶ˆé™¤çš„è·å–å’Œæ¸²æŸ“ç´§å¯†è€¦åˆçš„ç›¸åŒé—®é¢˜ ğŸ˜•ã€‚è¿™æ˜¯å› ä¸ºå½“ä½ ä½¿ç”¨ React.lazy() æ—¶ï¼Œä½ ä¼šä¸ºä½ çš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å—ï¼Œä½† React ç›´åˆ°æ¸²æŸ“æ‡’æƒ°ç»„ä»¶æ‰å¼€å§‹è·å–è¯¥å—ã€‚

```tsx
// app.jsx
const LazyComponent = React.lazy(() => import('./component'))

function App() {
  return (
    <React.Suspense fallback={<p>Loading lazy chunk...</p>}>
      <LazyComponent />
    </React.Suspense>
  )
}
```

![React.lazy() è°ƒç”¨ä¼šäº§ç”Ÿç±»ä¼¼çš„æ¸²æŸ“ + è·å–é“¾ã€‚](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/EwyafS.jpg)

å› æ­¤ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®è·¯ç”±å™¨ä¸­åˆ©ç”¨ React.lazy()ï¼Œä½†æœ€ç»ˆä¼šå¼•å…¥ä¸€ä¸ªé“¾æ¥ä¸‹è½½ç»„ä»¶ã€‚Ruben Casas æ’°å†™äº†[ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç« ](https://www.infoxicator.com/en/react-router-6-4-code-splitting)ï¼Œä»‹ç»äº†ä¸€äº›ä½¿ç”¨ React.lazy() åœ¨æ•°æ®è·¯ç”±å™¨ä¸­è¿›è¡Œä»£ç æ‹†åˆ†çš„æ–¹æ³•ã€‚ä½†æ˜¯ä»è¿™ç¯‡æ–‡ç« ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ‰‹åŠ¨è¿›è¡Œä»£ç æ‹†åˆ†ä»ç„¶æœ‰ç‚¹å†—é•¿å’Œç¹çã€‚å› ä¸º DX ä¸å¤Ÿå¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¶åˆ°äº†[@rossipedia æå‡ºçš„å»ºè®®](https://github.com/remix-run/react-router/discussions/9826)ï¼ˆå’Œåˆå§‹ [POC å®ç°](https://github.com/remix-run/react-router/pull/9830)ï¼‰ã€‚è¿™ä¸ªå»ºè®®å¾ˆå¥½åœ°æ¦‚è¿°äº†å½“å‰é¢ä¸´çš„æŒ‘æˆ˜ï¼Œå¹¶è®©æˆ‘ä»¬å¼€å§‹æ€è€ƒå¦‚ä½•åœ¨ RouterProvider ä¸­å¼•å…¥ä¸€æµçš„ä»£ç æ‹†åˆ†æ”¯æŒã€‚æˆ‘ä»¬è¦å‘è¿™ä¸¤ä½ï¼ˆä»¥åŠå…¶ä»–ä¼˜ç§€ç¤¾åŒºæˆå‘˜ï¼‰è‡´ä»¥å·¨å¤§çš„èµæ‰¬ï¼Œæ„Ÿè°¢ä»–ä»¬ç§¯æå‚ä¸ React Router æ¼”è¿› ğŸ™Œã€‚

## ä»‹ç» Route.lazy

å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‡’åŠ è½½ä¸æ•°æ®è·¯ç”±å™¨è‰¯å¥½åœ°é…åˆï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨æ¸²æŸ“å‘¨æœŸä¹‹å¤–å¼•å…¥æƒ°æ€§ã€‚å°±åƒæˆ‘ä»¬å°†æ•°æ®è·å–ä»æ¸²æŸ“å‘¨æœŸä¸­æå–å‡ºæ¥ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›å°†è·¯ç”±è·å–æå–å‡ºæ¥ã€‚

å¦‚æœä½ é€€åä¸€æ­¥ï¼Œçœ‹å¾…è·¯ç”±å®šä¹‰ï¼Œå®ƒå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

- è·¯å¾„åŒ¹é…å­—æ®µï¼Œä¾‹å¦‚è·¯å¾„ã€ç´¢å¼•å’Œå­èŠ‚ç‚¹
- æ•°æ®åŠ è½½/æäº¤å­—æ®µï¼Œå¦‚åŠ è½½å™¨å’Œæ“ä½œ
- æ¸²æŸ“å­—æ®µï¼Œå¦‚å…ƒç´ å’Œé”™è¯¯å…ƒç´ 

æ•°æ®è·¯ç”±å™¨åœ¨å…³é”®è·¯å¾„ä¸ŠçœŸæ­£éœ€è¦çš„æ˜¯åŒ¹é…è·¯å¾„å­—æ®µï¼Œå› ä¸ºå®ƒéœ€è¦èƒ½å¤Ÿè¯†åˆ«ç»™å®š URL åŒ¹é…çš„æ‰€æœ‰è·¯ç”±ã€‚åŒ¹é…åï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†å¼‚æ­¥å¯¼èˆªæ­£åœ¨è¿›è¡Œä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰ç†ç”±ä¸èƒ½åœ¨è¯¥å¯¼èˆªæœŸé—´è·å–è·¯ç”±ä¿¡æ¯ã€‚ç„¶åï¼Œåœ¨å®Œæˆæ•°æ®è·å–ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¸²æŸ“æ–¹é¢çš„å†…å®¹ï¼Œå› ä¸ºç›´åˆ°æ•°æ®è·å–å®Œæˆä¹‹å‰æˆ‘ä»¬æ‰ä¼šå‘ˆç°ç›®æ ‡è·¯çº¿ã€‚æ˜¯çš„ï¼Œè¿™å¯èƒ½ä¼šå¼•å…¥â€œé“¾â€çš„æ¦‚å¿µï¼ˆåŠ è½½è·¯çº¿ï¼Œç„¶ååŠ è½½æ•°æ®ï¼‰ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„æ æ†ä½œç”¨ï¼Œåœ¨éœ€è¦æ—¶å¯ä»¥æ‹‰åŠ¨ä»¥è§£å†³åˆå§‹åŠ è½½é€Ÿåº¦å’Œéšåå¯¼èˆªé€Ÿåº¦ä¹‹é—´çš„æƒè¡¡é—®é¢˜ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¸Šé¢çš„è·¯ç”±ç»“æ„å’Œåœ¨ä¸€ä¸ªè·¯ç”±å®šä¹‰ä¸­ä½¿ç”¨æ–°çš„ lazy() æ–¹æ³•ï¼ˆåœ¨ React Router v6.9.0 ä¸­å¯ç”¨ï¼‰çš„ç¤ºä¾‹ï¼š

```tsx
// app.jsx
import Layout, { getUser } from `./layout`;
import Home from `./home`;

const routes = [{
  path: '/',
  loader: () => getUser(),
  element: <Layout />,
  children: [{
    index: true,
    element: <Home />,
  }, {
    path: 'projects',
    lazy: () => import("./projects"), // ğŸ’¤ Lazy load!
    children: [{
      path: ':projectId',
      lazy: () => import("./project"), // ğŸ’¤ Lazy load!
    }],
  }],
}]

// projects.jsx
export function loader = () => { ... }; // formerly named getProjects

export function Component() { ... } // formerly named Projects

// project.jsx
export function loader = () => { ... }; // formerly named getProject

export function Component() { ... } // formerly named Project
```

ä½ é—®çš„æ˜¯å¯¼å‡ºåŠŸèƒ½ç»„ä»¶å—ï¼Ÿä»è¿™ä¸ªæƒ°æ€§æ¨¡å—ä¸­å¯¼å‡ºçš„å±æ€§ä¼šé€å­—æ·»åŠ åˆ°è·¯ç”±å®šä¹‰ä¸­ã€‚å› ä¸ºå¯¼å‡ºä¸€ä¸ªå…ƒç´ å¾ˆå¥‡æ€ªï¼Œæ‰€ä»¥æˆ‘ä»¬å¢åŠ äº†åœ¨è·¯ç”±å¯¹è±¡ä¸Šå®šä¹‰ç»„ä»¶è€Œä¸æ˜¯å…ƒç´ çš„æ”¯æŒï¼ˆä½†åˆ«æ‹…å¿ƒï¼Œå…ƒç´ ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼ï¼‰ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©å°†å¸ƒå±€å’Œä¸»é¡µè·¯ç”±ç•™åœ¨ä¸»è¦æ†ç»‘åŒ…ä¸­ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬ç”¨æˆ·æœ€å¸¸ç”¨çš„å…¥å£ç‚¹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å·²ç»å°†é¡¹ç›®å¯¼å…¥å’Œï¼šprojectId è·¯ç”±çš„å¯¼å…¥ç§»åŠ¨åˆ°å®ƒä»¬è‡ªå·±çš„åŠ¨æ€å¯¼å…¥ä¸­ï¼Œåœ¨æ²¡æœ‰å¯¼èˆªåˆ°é‚£äº›è·¯ç”±æ—¶ä¸ä¼šè¢«åŠ è½½ã€‚

åˆå§‹åŠ è½½æ—¶ï¼Œç”Ÿæˆçš„ç½‘ç»œå›¾å¤§è‡´å¦‚ä¸‹ï¼š

![lazy() æ–¹æ³•å…è®¸æˆ‘ä»¬ç¼©å‡å…³é”®è·¯å¾„æ†ç»‘åŒ…](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/EgKROK.jpg)

ç°åœ¨æˆ‘ä»¬çš„å…³é”®è·¯å¾„æ†ç»‘åŒ…ä»…åŒ…æ‹¬æˆ‘ä»¬è®¤ä¸ºå¯¹äºè¿›å…¥ç½‘ç«™æœ€ä¸ºå…³é”®çš„é‚£äº›è·¯ç”±ã€‚ç„¶åï¼Œå½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥åˆ° /projects/123 æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ lazy() æ–¹æ³•å¹¶è¡Œè·å–è¿™äº›è·¯ç”±ï¼Œå¹¶æ‰§è¡Œå®ƒä»¬è¿”å›çš„åŠ è½½å™¨æ–¹æ³•ï¼š

![æˆ‘ä»¬åœ¨å¯¼èˆªæ—¶å¹¶è¡Œåœ°æƒ°æ€§åŠ è½½è·¯ç”±](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/wcKLHR.jpg)

è¿™è®©æˆ‘ä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šå…¼é¡¾äº†ä¸¤å…¨å…¶ç¾çš„æ•ˆæœï¼Œå› ä¸ºæˆ‘ä»¬èƒ½å¤Ÿå°†å…³é”®è·¯å¾„æ†ç»‘åˆ°ç›¸å…³çš„ä¸»é¡µè·¯ç”±ä¸­ã€‚ç„¶ååœ¨å¯¼èˆªæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŒ¹é…è·¯å¾„å¹¶è·å–æ‰€éœ€çš„æ–°è·¯ç”±å®šä¹‰ã€‚

## é«˜çº§ç”¨æ³•å’Œä¼˜åŒ–

ä¸€äº›æ•é”çš„è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°ä¸€äº› ğŸ•·ï¸ èœ˜è››ä¾ èˆ¬çš„ç›´è§‰ï¼Œè®¤ä¸ºè¿™é‡Œéšè—ç€ä¸€äº›é“¾æ¥ã€‚è¿™æ˜¯æœ€ä¼˜ç½‘ç»œå›¾å—ï¼Ÿäº‹å®è¯æ˜ä¸æ˜¯ï¼ä½†è€ƒè™‘åˆ°æˆ‘ä»¬æ²¡æœ‰ç¼–å†™å¤šå°‘ä»£ç å°±å¾—åˆ°äº†å®ƒï¼Œå®ƒè¿˜æ˜¯ç›¸å½“ä¸é”™çš„ ğŸ˜‰ã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„è·¯ç”±æ¨¡å—åŒ…æ‹¬æˆ‘ä»¬çš„åŠ è½½å™¨å’Œç»„ä»¶ï¼Œè¿™æ„å‘³ç€åœ¨å¼€å§‹åŠ è½½ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸¤è€…çš„å†…å®¹ã€‚å®é™…ä¸Šï¼Œåœ¨ React Router SPA ä¸­ï¼Œæ‚¨çš„åŠ è½½ç¨‹åºé€šå¸¸éå¸¸å°ï¼Œå¹¶ä¸”ä¼šè®¿é—®å¤–éƒ¨ APIï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘éƒ½å­˜åœ¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç»„ä»¶å®šä¹‰äº†æ•´ä¸ªç”¨æˆ·ç•Œé¢ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸å…¶ç›¸å…³è”çš„ç”¨æˆ·äº¤äº’ - å®ƒä»¬å¯èƒ½ä¼šå˜å¾—ç›¸å½“å¤§ã€‚

![å•ä¸€è·¯ç”±æ–‡ä»¶ä¼šé˜»æ­¢ç»„ä»¶ä¸‹è½½åçš„æ•°æ®è·å–](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/nLUSHE.jpg)

é˜»æ­¢åŠ è½½ç¨‹åºï¼ˆå¯èƒ½æ­£åœ¨å¯¹æŸä¸ª API è¿›è¡Œ fetch() è°ƒç”¨ï¼‰é€šè¿‡ JS ä¸‹è½½å¤§å‹ç»„ä»¶æ ‘ä¼¼ä¹å¾ˆæ„šè ¢ã€‚å¦‚æœæˆ‘ä»¬èƒ½æŠŠè¿™ä¸ª ğŸ‘† å˜æˆè¿™ä¸ª ğŸ‘‡ ä¼šæ€æ ·ï¼Ÿ

![æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç»„ä»¶æå–åˆ°å®ƒè‡ªå·±çš„æ–‡ä»¶ä¸­æ¥è§£é™¤æ•°æ®è·å–çš„é˜»å¡](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/K6H8JY.jpg)

å¥½æ¶ˆæ¯æ˜¯ï¼Œæ‚¨åªéœ€è¿›è¡Œæœ€å°‘é‡çš„ä»£ç æ›´æ”¹å³å¯å®ç°ï¼å¦‚æœåœ¨è·¯ç”±ä¸Šé™æ€å®šä¹‰äº†ä¸€ä¸ªåŠ è½½å™¨/æ“ä½œï¼Œåˆ™å®ƒå°†ä¸ lazy() å¹¶è¡Œæ‰§è¡Œã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†åŠ è½½å™¨å’Œç»„ä»¶åˆ†å¼€æˆä¸åŒçš„æ–‡ä»¶æ¥è§£è€¦åŠ è½½å™¨æ•°æ®è·å–å’Œç»„ä»¶å—ä¸‹è½½ï¼š

```tsx
const routes = [
  {
    path: 'projects',
    async loader({ request, params }) {
      let { loader } = await import('./projects-loader')
      return loader({ request, params })
    },
    lazy: () => import('./projects-component'),
  },
]
```

åœ¨è·¯ç”±ä¸Šé™æ€å®šä¹‰çš„ä»»ä½•å­—æ®µéƒ½å°†å§‹ç»ˆä¼˜å…ˆäºä» lazy è¿”å›çš„ä»»ä½•å†…å®¹ã€‚å› æ­¤ï¼Œè™½ç„¶æ‚¨ä¸åº”è¯¥åŒæ—¶å®šä¹‰é™æ€åŠ è½½ç¨‹åºå¹¶ä» lazy è¿”å›åŠ è½½ç¨‹åºï¼Œä½†å¦‚æœè¿™æ ·åšï¼Œåˆ™ä¼šå¿½ç•¥æ‡’æƒ°ç‰ˆæœ¬ï¼Œå¹¶è·å¾—æ§åˆ¶å°è­¦å‘Šã€‚

è¿™ä¸ªé™æ€å®šä¹‰çš„åŠ è½½å™¨æ¦‚å¿µè¿˜ä¸ºç›´æ¥å†…è”ä»£ç æ‰“å¼€äº†ä¸€äº›æœ‰è¶£çš„å¯èƒ½æ€§ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸ä½ æœ‰ä¸€ä¸ªå•ç‹¬çš„ API ç«¯ç‚¹ï¼Œå®ƒçŸ¥é“å¦‚ä½•åŸºäºè¯·æ±‚ URL è·å–ç»™å®šè·¯ç”±çš„æ•°æ®ã€‚ä½ å¯ä»¥ä»¥æœ€å°æ†ç»‘æˆæœ¬å†…è”æ‰€æœ‰åŠ è½½å™¨ï¼Œå¹¶åœ¨æ•°æ®è·å–å’Œç»„ä»¶ï¼ˆæˆ–è·¯ç”±æ¨¡å—ï¼‰å—ä¸‹è½½ä¹‹é—´å®ç°å®Œå…¨å¹¶è¡ŒåŒ–ã€‚

```tsx
const routes = [
  {
    path: 'projects',
    loader: ({ request }) => fetchDataForUrl(request.url),
    lazy: () => import('./projects-component'),
  },
]
```

![çœ‹å•Šï¼Œå¦ˆå¦ˆï¼Œæ²¡æœ‰åŠ è½½å™¨å—ï¼](https://cdn.jsdelivr.net/gh/klaaay/pbed@main/uPic/1blpUr.jpg)
